# é¡¹ç›®æ–‡ä»¶æ¸…å•

## âœ… å·²ç”Ÿæˆçš„å®Œæ•´æ–‡ä»¶åˆ—è¡¨

### ğŸ“‹ é…ç½®æ–‡ä»¶
- âœ… `README.md` - é¡¹ç›®è¯´æ˜æ–‡æ¡£
- âœ… `.env.example` - ç¯å¢ƒå˜é‡ç¤ºä¾‹
- âœ… `.env` - ç¯å¢ƒå˜é‡é…ç½®ï¼ˆå·²ä»ç¤ºä¾‹å¤åˆ¶ï¼‰
- âœ… `.gitignore` - Git å¿½ç•¥è§„åˆ™
- âœ… `Dockerfile` - Docker é•œåƒæ„å»ºæ–‡ä»¶
- âœ… `docker-compose.yml` - Docker Compose ç¼–æ’æ–‡ä»¶

### ğŸ åç«¯ä»£ç  (`server/`)
- âœ… `server/__init__.py` - åŒ…åˆå§‹åŒ–æ–‡ä»¶
- âœ… `server/requirements.txt` - Python ä¾èµ–æ¸…å•
- âœ… `server/settings.py` - åº”ç”¨é…ç½®ç®¡ç†
- âœ… `server/models.py` - SQLAlchemy æ•°æ®åº“æ¨¡å‹
- âœ… `server/schema.py` - Pydantic æ•°æ®æ¨¡å‹
- âœ… `server/scoring.py` - è¯„åˆ†ç®—æ³•å®ç°
- âœ… `server/app.py` - FastAPI ä¸»åº”ç”¨

### ğŸ¨ å‰ç«¯æ–‡ä»¶ (`public/`)
- âœ… `public/index.html` - ä¸»é¡µé¢
- âœ… `public/styles.css` - æ ·å¼è¡¨
- âœ… `public/main.js` - å‰ç«¯äº¤äº’é€»è¾‘

### ğŸ“Š ç¤ºä¾‹æ•°æ® (`data/entries/`)
- âœ… `data/entries/sample-quaver.yml` - Quaver éŸ³ä¹åŠ©æ‰‹ç¤ºä¾‹
- âœ… `data/entries/sample-datalens.yml` - DataLens æ•°æ®ä¸­å°ç¤ºä¾‹

### ğŸ”§ è„šæœ¬ (`scripts/`)
- âœ… `scripts/import_entries.py` - YAML æ•°æ®å¯¼å…¥è„šæœ¬

### ğŸ“¦ å­˜å‚¨ç›®å½• (`storage/`)
- âœ… `storage/.gitkeep` - ä¿ç•™ç›®å½•ç»“æ„ï¼ˆæ•°æ®åº“è¿è¡Œæ—¶ç”Ÿæˆï¼‰

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šä½¿ç”¨ Dockerï¼ˆæ¨èï¼‰

```bash
# 1. å¯åŠ¨æœåŠ¡
docker compose up -d

# 2. æŸ¥çœ‹æ—¥å¿—
docker compose logs -f

# 3. è®¿é—®åº”ç”¨
open http://localhost:8000
```

### æ–¹å¼äºŒï¼šæœ¬åœ°è¿è¡Œ

```bash
# 1. å®‰è£…ä¾èµ–
pip install -r server/requirements.txt

# 2. å¯¼å…¥æ•°æ®
python scripts/import_entries.py

# 3. å¯åŠ¨æœåŠ¡
uvicorn server.app:app --host 0.0.0.0 --port 8000 --reload

# 4. è®¿é—®åº”ç”¨
open http://localhost:8000
```

---

## ğŸ“¡ API ç«¯ç‚¹

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | å‚æ•° |
|------|------|------|------|
| GET | `/` | è¿”å›å‰ç«¯é¡µé¢ | - |
| GET | `/api/entries` | è·å–æ‰€æœ‰æ¡ç›®ï¼ˆå«å®æ—¶è¯„åˆ†ï¼‰ | - |
| POST | `/api/vote` | ä¸ºæ¡ç›®æŠ•ç¥¨ | `{entry_id: "xxx"}` |
| POST | `/api/reload` | é‡æ–°åŠ è½½æ¡ç›® | Header: `X-Admin-Token` |
| GET | `/health` | å¥åº·æ£€æŸ¥ | - |

---

## ğŸ¯ åŠŸèƒ½éªŒæ”¶æ¸…å•

### âœ… æ ¸å¿ƒåŠŸèƒ½
- [x] å±•ç¤ºé¡¹ç›®åˆ—è¡¨ï¼ˆæ ‡é¢˜ã€æè¿°ã€æœ€åæ´»è·ƒæ—¶é—´ã€åˆ†æ•°ï¼‰
- [x] "è¸©ä¸€è„š"æŠ•ç¥¨æŒ‰é’®
- [x] å®æ—¶æ’è¡Œæ¦œï¼ˆæŒ‰åˆ†æ•°é™åºï¼‰
- [x] è¯„åˆ†æ¨¡å‹å®ç°ï¼ˆæŠ•ç¥¨åˆ† 0-60 + åœæ›´åˆ† 0-40ï¼‰

### âœ… é˜²åˆ·æœºåˆ¶
- [x] IP å“ˆå¸Œå­˜å‚¨ï¼ˆä¸ä¿å­˜æ˜æ–‡ IPï¼‰
- [x] æ¯ä¸ª IP æ¯å¤©æ¯æ¡ç›®é™æŠ• 1 ç¥¨
- [x] æŠ•ç¥¨å¤±è´¥è¿”å›å‹å¥½é”™è¯¯ä¿¡æ¯

### âœ… æŠ€æœ¯å®ç°
- [x] Python 3.11 + FastAPI
- [x] SQLite + SQLAlchemy
- [x] åŸç”Ÿ HTML/CSS/JSï¼ˆæ— æ¡†æ¶ï¼‰
- [x] Docker + Docker Compose ä¸€é”®éƒ¨ç½²
- [x] YAML æ–‡ä»¶æŠ•ç¨¿ç³»ç»Ÿ

### âœ… ç”¨æˆ·ä½“éªŒ
- [x] å“åº”å¼è®¾è®¡ï¼ˆç§»åŠ¨ç«¯å‹å¥½ï¼‰
- [x] æš—è‰²ä¸»é¢˜ + æš–æ©™è‰²ç‚¹ç¼€
- [x] åŠ è½½çŠ¶æ€æç¤º
- [x] æŠ•ç¥¨æˆåŠŸ/å¤±è´¥ Toast æç¤º
- [x] æŒ‰é’®é˜²æŠ–ï¼ˆ2ç§’å†·å´ï¼‰

---

## ğŸ“ è¯„åˆ†å…¬å¼

```python
# æŠ•ç¥¨åˆ†æ•° (0-60)
V = min(60, round(20 * log2(1 + votes)))

# åœæ›´åˆ†æ•° (0-40)
S = min(40, floor(days_since_last_commit / 7))

# æ€»åˆ† (0-100)
score = min(100, V + S)
```

---

## ğŸ” å®‰å…¨ç‰¹æ€§

1. **IP å“ˆå¸Œ**ï¼š`sha256(ip + SECRET_KEY + date)` - ä¸å­˜å‚¨æ˜æ–‡ IP
2. **CORS é…ç½®**ï¼šå¯é€šè¿‡ç¯å¢ƒå˜é‡é™åˆ¶å…è®¸çš„åŸŸå
3. **ç®¡ç†æ¥å£ä¿æŠ¤**ï¼š`/api/reload` éœ€è¦ Admin Token
4. **XSS é˜²æŠ¤**ï¼šå‰ç«¯ä½¿ç”¨ `textContent` é¿å… HTML æ³¨å…¥
5. **SQL æ³¨å…¥é˜²æŠ¤**ï¼šä½¿ç”¨ SQLAlchemy ORM å‚æ•°åŒ–æŸ¥è¯¢

---

## ğŸ“ æ·»åŠ æ–°æ¡ç›®

åœ¨ `data/entries/` åˆ›å»º YAML æ–‡ä»¶ï¼š

```yaml
id: my-project
title: æˆ‘çš„é¡¹ç›®
owner: Your Name
repo_url: https://github.com/yourname/project
last_commit: 2024-10-01
summary: é¡¹ç›®æè¿°...
tags: [web, app]
```

ç„¶åé‡å¯å®¹å™¨æˆ–è°ƒç”¨ï¼š

```bash
curl -X POST http://localhost:8000/api/reload \
  -H "X-Admin-Token: your-admin-token"
```

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆè¯¦æƒ…

### åç«¯ä¾èµ–
- `fastapi==0.109.0` - Web æ¡†æ¶
- `uvicorn[standard]==0.27.0` - ASGI æœåŠ¡å™¨
- `sqlalchemy==2.0.25` - ORM
- `pydantic==2.5.3` - æ•°æ®éªŒè¯
- `pydantic-settings==2.1.0` - é…ç½®ç®¡ç†
- `pyyaml==6.0.1` - YAML è§£æ
- `python-multipart==0.0.6` - è¡¨å•æ•°æ®å¤„ç†

### å‰ç«¯æŠ€æœ¯
- åŸç”Ÿ HTML5
- åŸç”Ÿ CSS3ï¼ˆCSS Grid + Flexboxï¼‰
- åŸç”Ÿ JavaScriptï¼ˆES6+ï¼‰
- Fetch API

### æ•°æ®åº“
- SQLite 3
- ä¸¤å¼ è¡¨ï¼š`entries`ï¼ˆæ¡ç›®ï¼‰ã€`votes`ï¼ˆæŠ•ç¥¨ï¼‰

---

## ğŸ“Š æ•°æ®åº“ç»“æ„

### entries è¡¨
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | STRING (PK) | æ¡ç›®å”¯ä¸€æ ‡è¯† |
| title | STRING | é¡¹ç›®æ ‡é¢˜ |
| owner | STRING | æ‰€æœ‰è€… |
| repo_url | STRING | ä»“åº“é“¾æ¥ |
| last_commit | DATE | æœ€åæäº¤æ—¥æœŸ |
| summary | STRING | é¡¹ç›®ç®€ä»‹ |
| tags | STRING | æ ‡ç­¾ï¼ˆé€—å·åˆ†éš”ï¼‰ |

### votes è¡¨
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER (PK) | è‡ªå¢ä¸»é”® |
| entry_id | STRING | æ¡ç›® ID |
| vote_date | DATE | æŠ•ç¥¨æ—¥æœŸ |
| ip_hash | STRING | IP å“ˆå¸Œ |

**å”¯ä¸€ç´¢å¼•**ï¼š`(entry_id, vote_date, ip_hash)`

---

## ğŸ¨ è®¾è®¡è§„èŒƒ

### é¢œè‰²å˜é‡
```css
--color-bg: #1a1a1a          /* èƒŒæ™¯ */
--color-bg-card: #252525     /* å¡ç‰‡èƒŒæ™¯ */
--color-text: #e0e0e0        /* æ–‡å­— */
--color-primary: #ff6b35     /* ä¸»é¢˜è‰²ï¼ˆæš–æ©™ï¼‰ */
```

### å“åº”å¼æ–­ç‚¹
- ç§»åŠ¨ç«¯ï¼š< 768pxï¼ˆå•åˆ—å¸ƒå±€ï¼‰
- æ¡Œé¢ç«¯ï¼šâ‰¥ 768pxï¼ˆ2åˆ—å¸ƒå±€ï¼‰

---

## âš–ï¸ ä¼¦ç†å£°æ˜

æœ¬é¡¹ç›®éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

1. **ä»…æ”¶å½•æˆæƒå†…å®¹**ï¼šæŠ•ç¨¿è€…å¿…é¡»æ‹¥æœ‰é¡¹ç›®ç‰ˆæƒæˆ–å·²è·æ˜ç¡®æˆæƒ
2. **å¿…é¡»è„±æ•**ï¼šåˆ é™¤å¯†é’¥ã€éšç§æ•°æ®ã€å…¬å¸æœºå¯†
3. **å°Šé‡è´¡çŒ®è€…**ï¼šä¿ç•™ç½²åï¼Œä¸ä»¥ç¾è¾±ä¸ºç›®çš„
4. **é¼“åŠ±å¤æ´»**ï¼šå¯éšæ—¶æ›´æ–°çŠ¶æ€ä¸º"å¤æ´»ä¸­"

---

## ğŸ“„ è®¸å¯è¯

MIT License

---

**ç¥å¥‡æµ·èºè¯´**ï¼š*çƒ‚å°¾ä¸å¯æ€•ï¼Œå¯æ€•çš„æ˜¯ä¸æ•¢å¼€å§‹ã€‚*
